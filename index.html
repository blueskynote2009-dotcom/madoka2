import React, { useState, useEffect, useCallback } from 'react';
import { Timer, CheckCircle, XCircle, Play, RotateCcw, Award, ArrowRight, Heart, Coffee, Leaf, Sparkles, Lightbulb, Shuffle, ChevronRight } from 'lucide-react';

/**
 * ã¾ã©ã‹å…ˆç”Ÿã®è‹±èªã®ä¿å¥å®¤ï¼šæ€è€ƒã®ã‚¹ã‚­ãƒ£ãƒ‹ãƒ³ã‚°ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°
 * å…±é€šãƒ†ã‚¹ãƒˆã®ã€ŒæŠ½è±¡ãƒ»å…·ä½“ã€ã®è¨€ã„æ›ãˆã«ç‰¹åŒ–ã—ãŸ20å•ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã‚¢ãƒ—ãƒªã€‚
 * å¤–éƒ¨DBä¸è¦ã€å˜ä¸€ãƒ•ã‚¡ã‚¤ãƒ«ã§å®Œçµã—ãƒ‡ãƒ—ãƒ­ã‚¤å¯èƒ½ã§ã™ã€‚
 */

const App = () => {
  const [gameState, setGameState] = useState('start'); 
  const [currentLevelIdx, setCurrentLevelIdx] = useState(0);
  const [shuffledLevels, setShuffledLevels] = useState([]);
  const [score, setScore] = useState(0);
  const [timeLeft, setTimeLeft] = useState(300); 
  const [feedback, setFeedback] = useState(null); 
  const [combo, setCombo] = useState(0);
  const [showThinkingPoint, setShowThinkingPoint] = useState(false);
  const [selectedOption, setSelectedOption] = useState(null);

  // å…¨20å•ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼ˆ1å•5ç‚¹ Ã— 20å• ï¼ 100ç‚¹ï¼‰
  const allLevels = [
    {
      type: "ã€å…·ä½“ â†’ æŠ½è±¡ã€‘",
      target: "hamsters, rabbits, and guinea pigs",
      options: ["small pet animals", "aquatic creatures", "wild predators", "colorful birds"],
      answer: "small pet animals",
      thinking: "å€‹åˆ¥ã®å‹•ç‰©ã®åå‰ã‚’ã€å°å‹•ç‰©ã€ã¨ã„ã†ã‚«ãƒ†ã‚´ãƒªãƒ¼ã«ã¾ã¨ã‚ã¦ã„ã¾ã™ã€‚"
    },
    {
      type: "ã€å…·ä½“ â†’ æŠ½è±¡ã€‘",
      target: "from 9:00 AM to 5:00 PM",
      options: ["during the daytime", "throughout the night", "at sunset", "twice a week"],
      answer: "during the daytime",
      thinking: "å…·ä½“çš„ãªæ™‚åˆ»ã‚’ã€æ—¥ä¸­ã€ã¨ã„ã†æ™‚é–“æ¦‚å¿µã«å¤‰æ›ã—ã¦ã„ã¾ã™ã€‚"
    },
    {
      type: "ã€å…·ä½“ â†’ æŠ½è±¡ã€‘",
      target: "well tested and controlled",
      options: ["properly assessed", "newly invented", "cheap and fast", "dangerous to use"],
      answer: "properly assessed",
      thinking: "ã€ãƒ†ã‚¹ãƒˆãƒ»åˆ¶å¾¡ã•ã‚Œã‚‹ã€ã‚’ã€é©åˆ‡ã«è©•ä¾¡ï¼ˆassessedï¼‰ã•ã‚Œã‚‹ã€ã¨ã„ã†æ¦‚å¿µã«ã€‚2025å¹´ç¬¬5å•ã®é‡è¦è¡¨ç¾ã§ã™ã€‚"
    },
    {
      type: "ã€å…·ä½“ â†’ æŠ½è±¡ã€‘",
      target: "no permit is required",
      options: ["can use it freely", "must pay a fee", "limited access", "only for students"],
      answer: "can use it freely",
      thinking: "ã€è¨±å¯ä¸è¦ã€ï¼ã€è‡ªç”±ã«ä½¿ãˆã‚‹ã€ã¨ã„ã†åˆ¤æ–­åŠ›ã‚’å•ã†è¨€ã„æ›ãˆã§ã™ã€‚"
    },
    {
      type: "ã€å…·ä½“ â†’ æŠ½è±¡ã€‘",
      target: "farthest from the entrance",
      options: ["at the back of the area", "near the front door", "beside the exit", "in the middle"],
      answer: "at the back of the area",
      thinking: "å…¥å£ã‹ã‚‰æœ€ã‚‚é ã„ï¼ã€ä¸€ç•ªå¥¥ã€ã‚’æŒ‡ã—ã¾ã™ã€‚"
    },
    {
      type: "ã€å…·ä½“ â†’ æŠ½è±¡ã€‘",
      target: "every Monday and Thursday",
      options: ["twice a week", "on weekends", "every other day", "daily"],
      answer: "twice a week",
      thinking: "ç‰¹å®šã®æ›œæ—¥ã‚’ã€é€±ã«ä½•å›ã€ã¨ã„ã†é »åº¦ã«æŠ½è±¡åŒ–ã—ã¦ã„ã¾ã™ã€‚"
    },
    {
      type: "ã€å…·ä½“ â†’ æŠ½è±¡ã€‘",
      target: "within 10 minutes on foot",
      options: ["walking distance", "by public transport", "an hour drive", "near the station"],
      answer: "walking distance",
      thinking: "ã€å¾’æ­©10åˆ†ä»¥å†…ã€ã‚’ã€å¾’æ­©åœå†…ã€ã¨è¨€ã„æ›ãˆã¦ã„ã¾ã™ã€‚"
    },
    {
      type: "ã€å…·ä½“ â†’ æŠ½è±¡ã€‘",
      target: "soft grass on the floor",
      options: ["vegetation bedding", "sandy ground", "wooden tiles", "plastic cover"],
      answer: "vegetation bedding",
      thinking: "ã€è‰ï¼ˆgrassï¼‰ã€ã‚’ã€æ¤ç‰©ï¼ˆvegetationï¼‰ã€ã¨ã„ã†ä¸Šä½èªã«å¤‰æ›ã—ã¦ã„ã¾ã™ã€‚"
    },
    {
      type: "ã€å…·ä½“ â†’ æŠ½è±¡ã€‘",
      target: "discount for students",
      options: ["reduced price for learners", "free admission", "full-price tickets", "group reservation"],
      answer: "reduced price for learners",
      thinking: "ã€å­¦ç”Ÿå‰²å¼•ã€ã‚’ã€å­¦ç¿’è€…ã®ãŸã‚ã®ä¾¡æ ¼æ¸›å…ã€ã¨èª¬æ˜çš„ã«è¨€ã„æ›ãˆã¦ã„ã¾ã™ã€‚"
    },
    {
      type: "ã€å…·ä½“ â†’ æŠ½è±¡ã€‘",
      target: "18 years old and over",
      options: ["adults only", "children only", "for families", "all ages"],
      answer: "adults only",
      thinking: "å¹´é½¢åˆ¶é™ã‚’ã€å¤§äººé™å®šã€ã¨ã„ã†ã‚«ãƒ†ã‚´ãƒªãƒ¼ã«æŠ½è±¡åŒ–ã—ã¦ã„ã¾ã™ã€‚"
    },
    {
      type: "ã€æŠ½è±¡ â†’ å…·ä½“ã€‘",
      target: "outdoor activities",
      options: ["hiking and camping", "coding and gaming", "reading and writing", "sleeping and dreaming"],
      answer: "hiking and camping",
      thinking: "ã€å±‹å¤–æ´»å‹•ã€ã®å…·ä½“çš„ãªä¸­èº«ã‚’ç‰¹å®šã™ã‚‹ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã§ã™ã€‚"
    },
    {
      type: "ã€æŠ½è±¡ â†’ å…·ä½“ã€‘",
      target: "medical facilities",
      options: ["hospitals and clinics", "theaters and parks", "banks and stores", "factories and farms"],
      answer: "hospitals and clinics",
      thinking: "ã€åŒ»ç™‚æ–½è¨­ã€ã¨ã„ã†è¨€è‘‰ã‹ã‚‰ã€å…·ä½“çš„ãªå ´æ‰€ã‚’æƒ³èµ·ã—ã¾ã™ã€‚"
    },
    {
      type: "ã€æŠ½è±¡ â†’ å…·ä½“ã€‘",
      target: "academic achievements",
      options: ["good grades and awards", "delicious food", "new clothes", "fast cars"],
      answer: "good grades and awards",
      thinking: "ã€å­¦æ¥­ã®æˆæœã€ã‚’å…·ä½“çš„ãªæˆç¸¾ã‚„è³ã«é–¢é€£ä»˜ã‘ã¾ã™ã€‚"
    },
    {
      type: "ã€æŠ½è±¡ â†’ å…·ä½“ã€‘",
      target: "digital devices",
      options: ["smartphones and tablets", "pens and pencils", "chairs and tables", "shoes and socks"],
      answer: "smartphones and tablets",
      thinking: "ã€ãƒ‡ã‚¸ã‚¿ãƒ«æ©Ÿå™¨ã€ã®å…·ä½“ä¾‹ã‚’ã‚¹ã‚­ãƒ£ãƒ³ã—ã¾ã™ã€‚"
    },
    {
      type: "ã€æŠ½è±¡ â†’ å…·ä½“ã€‘",
      target: "tropical fruits",
      options: ["mangoes and pineapples", "apples and pears", "grapes and cherries", "peaches and plums"],
      answer: "mangoes and pineapples",
      thinking: "ã‚«ãƒ†ã‚´ãƒªãƒ¼ã‚’å…·ä½“çš„ãªåå‰ã«åˆ†è§£ã™ã‚‹ç·´ç¿’ã§ã™ã€‚"
    },
    {
      type: "ã€æŠ½è±¡ â†’ å…·ä½“ã€‘",
      target: "dairy products",
      options: ["milk and cheese", "meat and fish", "bread and rice", "sugar and salt"],
      answer: "milk and cheese",
      thinking: "ã€ä¹³è£½å“ã€ã«å«ã¾ã‚Œã‚‹å…·ä½“çš„ãªé£Ÿå“ã‚’é¸ã³ã¾ã™ã€‚"
    },
    {
      type: "ã€æŠ½è±¡ â†’ å…·ä½“ã€‘",
      target: "seasonal changes",
      options: ["spring, summer, fall, winter", "morning, noon, evening", "north, south, east, west", "red, blue, yellow"],
      answer: "spring, summer, fall, winter",
      thinking: "ã€å­£ç¯€ã®ç§»ã‚Šå¤‰ã‚ã‚Šã€ã®ä¸­èº«ã‚’å…·ä½“çš„ã«ç‰¹å®šã—ã¾ã™ã€‚"
    },
    {
      type: "ã€æŠ½è±¡ â†’ å…·ä½“ã€‘",
      target: "emergency contacts",
      options: ["police and ambulance", "friends and family", "teachers and staff", "shop and cafe"],
      answer: "police and ambulance",
      thinking: "ã€ç·Šæ€¥é€£çµ¡å…ˆã€ã¨ã„ã†æ¦‚å¿µã‚’å…·ä½“çš„ãªæ©Ÿé–¢ã«çµã³ã¤ã‘ã¾ã™ã€‚"
    },
    {
      type: "ã€æŠ½è±¡ â†’ å…·ä½“ã€‘",
      target: "natural disasters",
      options: ["earthquakes and floods", "sunshine and rainbow", "festivals and events", "music and art"],
      answer: "earthquakes and floods",
      thinking: "ã€è‡ªç„¶ç½å®³ã€ã¨ã„ã†æŠ½è±¡èªã‚’å…·ä½“çš„ãªç¾è±¡ã«ç¿»è¨³ã—ã¾ã™ã€‚"
    },
    {
      type: "ã€æŠ½è±¡ â†’ å…·ä½“ã€‘",
      target: "daily necessities",
      options: ["food and water", "luxury watches", "designer bags", "sports cars"],
      answer: "food and water",
      thinking: "ã€ç”Ÿæ´»å¿…éœ€å“ã€ã¨ã„ã†è¨€è‘‰ãŒä½•ã‚’æŒ‡ã™ã‹ã‚’åˆ¤æ–­ã—ã¾ã™ã€‚"
    }
  ];

  const shuffleArray = (array) => {
    const newArr = [...array];
    for (let i = newArr.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [newArr[i], newArr[j]] = [newArr[j], newArr[i]];
    }
    return newArr;
  };

  const startGame = () => {
    // å•é¡Œã¨é¸æŠè‚¢ã®ä¸¡æ–¹ã‚’ã‚·ãƒ£ãƒƒãƒ•ãƒ«ã—ã¦é–‹å§‹
    const preparedLevels = shuffleArray(allLevels).map(level => ({
      ...level,
      options: shuffleArray(level.options)
    }));
    
    setShuffledLevels(preparedLevels);
    setGameState('playing');
    setCurrentLevelIdx(0);
    setScore(0);
    setTimeLeft(300);
    setCombo(0);
    setFeedback(null);
    setShowThinkingPoint(false);
    setSelectedOption(null);
  };

  const handleSelectAnswer = useCallback((option) => {
    if (showThinkingPoint) return;

    const isCorrect = option === shuffledLevels[currentLevelIdx].answer;
    setSelectedOption(option);

    if (isCorrect) {
      setScore(prev => prev + 5); 
      setCombo(prev => prev + 1);
      setFeedback('correct');
    } else {
      setCombo(0);
      setFeedback('wrong');
    }
    
    setShowThinkingPoint(true);
  }, [currentLevelIdx, shuffledLevels, showThinkingPoint]);

  const handleGoToNext = () => {
    if (currentLevelIdx < shuffledLevels.length - 1) {
      setCurrentLevelIdx(prev => prev + 1);
      setFeedback(null);
      setShowThinkingPoint(false);
      setSelectedOption(null);
    } else {
      setGameState('result');
    }
  };

  useEffect(() => {
    let timer;
    if (gameState === 'playing' && timeLeft > 0 && !showThinkingPoint) {
      timer = setInterval(() => {
        setTimeLeft(prev => prev - 1);
      }, 1000);
    } else if (timeLeft === 0) {
      setGameState('result');
    }
    return () => clearInterval(timer);
  }, [gameState, timeLeft, showThinkingPoint]);

  const theme = {
    bg: "bg-[#fdf8f1]", 
    card: "bg-white",
    primary: "bg-[#ffb7b2]", 
    primaryHover: "hover:bg-[#ff9a9e]",
    secondary: "bg-[#a8dadc]", 
    textMain: "text-[#5a4d44]", 
    textSub: "text-[#8e7e74]", 
  };

  return (
    <div className={`min-h-screen ${theme.bg} flex items-center justify-center p-4 font-sans ${theme.textMain} selection:bg-[#ffb7b2/30]`}>
      <div className={`w-full max-w-md ${theme.card} rounded-[3.5rem] shadow-[0_30px_70px_rgba(180,160,140,0.2)] overflow-hidden border-8 border-white flex flex-col min-h-[720px] relative transition-all duration-700`}>
        
        <div className="absolute -top-20 -right-20 w-64 h-64 bg-[#ffefef] rounded-full blur-[80px] opacity-60"></div>
        <div className="absolute -bottom-20 -left-20 w-64 h-64 bg-[#f0f9f0] rounded-full blur-[80px] opacity-60"></div>

        <div className="p-7 flex justify-between items-center relative z-10">
          <div className="flex items-center gap-2.5 text-[#b8a398]">
            <div className="bg-[#fff9f0] p-1.5 rounded-lg shadow-inner">
              <Leaf size={16} className="text-[#a8dadc]" />
            </div>
            <span className="text-[10px] font-bold tracking-[0.25em] uppercase opacity-70">The Healing Room</span>
          </div>
          {gameState === 'playing' && (
            <div className={`flex items-center gap-2 font-bold px-4 py-2 rounded-full shadow-sm transition-all ${timeLeft < 30 ? 'bg-red-50 text-red-400 font-black' : 'bg-white text-[#ff9a9e]'}`}>
              <Timer size={16} /> <span className="font-mono">{timeLeft}s</span>
            </div>
          )}
        </div>

        {gameState === 'start' && (
          <div className="flex-grow flex flex-col items-center justify-center p-10 text-center relative z-10 animate-in fade-in duration-1000">
            <div className="w-32 h-32 bg-[#fff9f0] rounded-full flex items-center justify-center text-[#e8b69d] mb-10 shadow-inner border-4 border-white relative">
              <Coffee size={56} strokeWidth={1} />
              <div className="absolute -top-2 -right-2 bg-white p-2 rounded-full shadow-md text-[#ffb7b2] animate-pulse">
                <Heart size={20} fill="currentColor" />
              </div>
            </div>
            <h2 className="text-3xl font-bold mb-5 tracking-tight leading-tight">æ€è€ƒã®ã‚¹ã‚­ãƒ£ãƒ‹ãƒ³ã‚°<br/><span className="text-[#ffb7b2]">20å•ãƒ»100ç‚¹æº€ç‚¹</span></h2>
            <p className={`${theme.textSub} text-[14px] mb-12 leading-relaxed px-4 italic font-medium`}>
              ã€ŒåŒã˜å˜èªã€ã‚’æ¢ã™ã®ã¯ã‚‚ã†å’æ¥­ã€‚<br/>
              è§£èª¬ã‚’ã˜ã£ãã‚Šèª­ã‚“ã§ã€è‡ªåˆ†ã®ãƒšãƒ¼ã‚¹ã§<br/>
              <b>ã€Œæ€è€ƒã®ãƒ–ãƒªãƒƒã‚¸ã€</b>ã‚’ãƒã‚¹ã‚¿ãƒ¼ã—ã¾ã—ã‚‡ã†ã€‚ğŸŒ¿
            </p>
            <button
              onClick={startGame}
              className={`w-full ${theme.primary} ${theme.primaryHover} text-white font-bold py-6 px-8 rounded-full text-xl shadow-xl shadow-[#ffb7b2/30] transition-all active:scale-95 flex items-center justify-center gap-3`}
            >
              <Play fill="white" size={24} /> ç‰¹è¨“ã‚’ã¯ã˜ã‚ã‚‹
            </button>
            <p className="mt-8 text-[9px] font-bold tracking-[0.3em] uppercase opacity-30 italic">Madoka's English Infirmary</p>
          </div>
        )}

        {gameState === 'playing' && shuffledLevels.length > 0 && (
          <div className="flex-grow flex flex-col p-8 relative z-10 animate-in fade-in duration-500">
            <div className="flex justify-between items-center mb-8">
              <div className="text-left">
                <span className="text-[10px] font-black text-[#b8a398] uppercase tracking-[0.2em] block mb-2 opacity-80 italic">
                  {shuffledLevels[currentLevelIdx].type}
                </span>
                <div className="text-2xl font-black italic text-[#e8b69d]">Score: {score}</div>
              </div>
              <div className="text-right">
                <div className="text-[10px] font-bold text-[#dcd0c9] mb-2 tracking-widest">{currentLevelIdx + 1} / 20</div>
                <div className="flex gap-1 max-w-[90px] flex-wrap justify-end">
                  {[...Array(20)].map((_, i) => (
                    <div key={i} className={`h-1.5 w-1.5 rounded-full transition-all duration-300 ${i <= currentLevelIdx ? 'bg-[#ffb7b2] scale-110 shadow-sm' : 'bg-slate-100'}`}></div>
                  ))}
                </div>
              </div>
            </div>

            <div className="bg-[#fffcf8] border-2 border-[#f5efeb] p-8 rounded-[3rem] text-center mb-10 relative shadow-sm min-h-[160px] flex items-center justify-center">
              <span className="absolute -top-3 left-1/2 -translate-x-1/2 bg-white px-5 py-1.5 rounded-full border border-[#f5efeb] text-[10px] font-black text-[#b8a398] uppercase tracking-[0.2em] italic shadow-sm">Target Phrase</span>
              
              <h3 className={`text-xl font-bold transition-all duration-500 ${showThinkingPoint ? 'scale-90 text-[#8e7e74] italic' : 'scale-100'}`}>
                "{shuffledLevels[currentLevelIdx].target}"
              </h3>
            </div>

            {!showThinkingPoint ? (
              <div className="grid grid-cols-1 gap-3.5 animate-in fade-in duration-300">
                <span className="text-[9px] font-bold text-[#b8a398] uppercase tracking-[0.2em] mb-2 ml-5 italic opacity-60">ãµã•ã‚ã—ã„è¡¨ç¾ã‚’é¸ã¶ï¼š</span>
                {shuffledLevels[currentLevelIdx].options.map((option, idx) => (
                  <button
                    key={idx}
                    onClick={() => handleSelectAnswer(option)}
                    className="w-full p-4.5 text-left rounded-[1.5rem] border-2 border-transparent bg-[#f9f5f2] hover:bg-white hover:border-[#ffb7b2] hover:shadow-lg transition-all font-bold text-[#7a6a5f] text-sm flex justify-between items-center group relative overflow-hidden active:scale-95"
                  >
                    <span className="relative z-10">{option}</span>
                    <ArrowRight size={18} className="text-[#dcd0c9] group-hover:text-[#ffb7b2] group-hover:translate-x-1.5 transition-all" />
                  </button>
                ))}
              </div>
            ) : (
              <div className="animate-in fade-in slide-in-from-bottom-4 duration-700 flex flex-col flex-grow">
                <div className={`w-full p-5 mb-6 rounded-[1.5rem] border-2 flex justify-between items-center shadow-sm ${
                  selectedOption === shuffledLevels[currentLevelIdx].answer 
                  ? 'border-[#82c182] bg-[#f0f9f0]' 
                  : 'border-[#ff9a9e] bg-[#fff5f5]'
                }`}>
                  <div className="flex items-center gap-3 font-bold text-sm">
                    {selectedOption === shuffledLevels[currentLevelIdx].answer 
                      ? <CheckCircle size={20} className="text-[#82c182]" /> 
                      : <XCircle size={20} className="text-[#ff9a9e]" />
                    }
                    <span className={selectedOption === shuffledLevels[currentLevelIdx].answer ? 'text-[#5a4d44]' : 'text-[#8e7e74]'}>
                      {selectedOption}
                    </span>
                  </div>
                  <span className="text-[10px] font-black uppercase tracking-widest opacity-40">Your Choice</span>
                </div>

                <div className="bg-[#fff9f0] p-6 rounded-[2rem] border-l-8 border-[#ffb7b2] flex gap-4 shadow-sm relative mb-8">
                  <div className="bg-white p-2 rounded-xl shadow-sm h-fit">
                    <Lightbulb className="text-[#ffb7b2]" size={22} />
                  </div>
                  <div className="text-[15px] leading-relaxed font-bold text-[#7a6a5f]">
                    <span className="text-[#b8a398] font-black block mb-2 uppercase tracking-tighter not-italic text-[11px]">Thinking Point</span>
                    {shuffledLevels[currentLevelIdx].thinking}
                  </div>
                </div>

                <button
                  onClick={handleGoToNext}
                  className={`mt-auto w-full py-5 rounded-full ${theme.secondary} text-white font-bold text-lg shadow-lg hover:brightness-105 active:scale-95 transition-all flex items-center justify-center gap-3 mb-2`}
                >
                  æ¬¡ã®å•é¡Œã¸ <ChevronRight size={20} />
                </button>
              </div>
            )}
            
            {!showThinkingPoint && (
              <div className="mt-auto text-center pt-4">
                 {combo > 1 && (
                  <div className="inline-flex items-center gap-2 bg-[#fff0f0] text-[#ff9a9e] px-5 py-2 rounded-full text-[11px] font-black italic shadow-sm animate-bounce">
                     <Sparkles size={12} /> {combo}å•ã‚Œã‚“ããï¼
                  </div>
                )}
              </div>
            )}
          </div>
        )}

        {gameState === 'result' && (
          <div className="flex-grow flex flex-col items-center justify-center p-12 animate-in zoom-in duration-1000 relative z-10 text-center">
            <div className="bg-[#fff9f0] p-7 rounded-full text-[#e8b69d] mb-8 shadow-inner border-4 border-white relative">
              <Award size={72} strokeWidth={1} />
              <div className="absolute top-0 right-0 animate-pulse text-[#ffb7b2]">
                <Sparkles size={32} />
              </div>
            </div>
            <h2 className="text-3xl font-bold mb-3 tracking-tighter leading-tight text-slate-800">ç‰¹è¨“ã€ãŠã¤ã‹ã‚Œã•ã¾ğŸŒ¿</h2>
            <p className="text-[#b8a398] font-bold text-[11px] mb-8 tracking-[0.3em] uppercase opacity-70 italic">Final Assessment</p>
            <div className="text-8xl font-black text-[#ffb7b2] mb-12 tracking-tighter drop-shadow-sm select-none">
              {score}<span className="text-3xl text-[#dcd0c9] ml-1">/100</span>
            </div>
            
            <div className="bg-[#fffcf8] p-8 rounded-[3rem] mb-12 w-full border-2 border-[#f5efeb] shadow-inner relative">
              <p className="text-[#8e7e74] text-[15px] leading-relaxed italic font-bold">
                {score === 100 
                  ? "ã€Sãƒ©ãƒ³ã‚¯ã€‘å®Œç’§ã§ã™ï¼20ã®å¤‰æ›ã‚’ã™ã¹ã¦ã“ãªã—ãŸã‚ãªãŸã¯ã€ã‚‚ã†ã©ã‚“ãªè¨€ã„æ›ãˆã«ã‚‚æƒ‘ã‚ã•ã‚Œã¾ã›ã‚“ã€‚è‡ªä¿¡ã‚’æŒã£ã¦æ‰‰ã‚’é–‹ã‘ã¦ãã ã•ã„ã­ã€‚" 
                  : score >= 80
                  ? "ã€Aãƒ©ãƒ³ã‚¯ã€‘ç´ æ™´ã‚‰ã—ã„ï¼å…·ä½“ã¨æŠ½è±¡ã‚’ç¹‹ãã‚¹ãƒ”ãƒ¼ãƒ‰ãŒæ ¼æ®µã«ä¸ŠãŒã£ã¦ã„ã¾ã™ã€‚æœ¬ç•ªã‚‚ãã®ãƒªã‚ºãƒ ã‚’å¤§åˆ‡ã«ã€‚"
                  : "ã€Bãƒ©ãƒ³ã‚¯ã€‘ã‚ˆãé ‘å¼µã‚Šã¾ã—ãŸã€‚ä¸€åº¦é–“é•ãˆãŸã€Thinking Pointã€ã‚’ã‚†ã£ãã‚Šè¦‹ç›´ã™ã ã‘ã§ã€æ¬¡ã¯ã‚‚ã£ã¨æ¥½ã«è§£ã‘ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã‚ˆã€‚"}
              </p>
            </div>

            <div className="space-y-5 w-full px-4">
              <button
                onClick={startGame}
                className="w-full text-[#b8a398] hover:text-[#7a6a5f] font-bold py-3 text-xs flex items-center justify-center gap-2 transition-all underline underline-offset-8 decoration-2"
              >
                <RotateCcw size={14} /> æ–°ã—ã„å•é¡Œã‚»ãƒƒãƒˆã§å†æŒ‘æˆ¦
              </button>
              <a 
                href="#" 
                className={`w-full ${theme.primary} ${theme.primaryHover} text-white font-bold py-6 rounded-full flex items-center justify-center gap-2 shadow-xl shadow-[#ffb7b2/20] transition-all active:scale-95 text-lg text-center`}
              >
                ã¾ã©ã‹å…ˆç”Ÿã®Noteã‚’èª­ã‚€ <Heart size={22} fill="white" />
              </a>
            </div>
          </div>
        )}

      </div>
    </div>
  );
};

export default App;
